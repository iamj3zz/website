{% comment %}
  Split Bandcamp-Metadata Module
  Two-column layout: iframe on left (1/3) and metadata on right (2/3)
  Perfect for Bandcamp players and other narrow embeds alongside detailed metadata

  Parameters:
  - embed_code: Full iframe embed code (required)
  - caption: Optional iframe caption

  Metadata fields (all optional):
  - All standard metadata fields supported

  Text content (optional):
  - text_title: Optional heading for text section
  - text_content: Text content in markdown format
{% endcomment %}

<div class="module module-split-bandcamp-metadata">
  <div class="split-bandcamp-container">

    {% comment %} Left column - Iframe (1/3 width) {% endcomment %}
    <div class="split-bandcamp-left">
      {% assign src_start = include.embed_code | split: 'src="' | last %}
      {% assign src_url = src_start | split: '"' | first %}

      {% comment %} Extract width from embed code {% endcomment %}
      {% assign width_start = include.embed_code | split: 'width: ' | last %}
      {% if width_start == include.embed_code %}
        {% assign width_start = include.embed_code | split: 'width:' | last %}
      {% endif %}
      {% if width_start == include.embed_code %}
        {% assign width_start = include.embed_code | split: 'width="' | last %}
      {% endif %}
      {% assign player_width = width_start | split: ';' | first | split: '"' | first | strip %}
      {% if player_width == "" or player_width == include.embed_code %}
        {% assign player_width = "100%" %}
      {% endif %}

      {% comment %} Extract height from embed code {% endcomment %}
      {% assign height_start = include.embed_code | split: 'height: ' | last %}
      {% if height_start == include.embed_code %}
        {% assign height_start = include.embed_code | split: 'height:' | last %}
      {% endif %}
      {% if height_start == include.embed_code %}
        {% assign height_start = include.embed_code | split: 'height="' | last %}
      {% endif %}
      {% assign player_height = height_start | split: ';' | first | split: '"' | first | strip %}
      {% if player_height == "" or player_height == include.embed_code %}
        {% assign player_height = "400px" %}
      {% endif %}

      <div class="split-bandcamp-iframe">
        <div class="iframe-wrapper">
          <iframe
            style="border: 0; width: {{ player_width }}; height: {{ player_height }};"
            src="{{ src_url }}"
            title="{% if include.caption %}{{ include.caption }}{% else %}Bandcamp player{% endif %}"
            allowfullscreen
            seamless>
          </iframe>
        </div>
        {% if include.caption %}
          <p class="iframe-caption">{{ include.caption }}</p>
        {% endif %}
      </div>
    </div>

    {% comment %} Right column - Metadata (2/3 width) {% endcomment %}
    <div class="split-bandcamp-right">
      {% include work-modules/metadata.html
         year=include.year
         year_link=include.year_link
         date=include.date
         date_link=include.date_link
         isrc=include.isrc
         isrc_link=include.isrc_link
         upc=include.upc
         upc_link=include.upc_link
         iswc=include.iswc
         iswc_link=include.iswc_link
         location=include.location
         location_link=include.location_link
         performed_in=include.performed_in
         performed_in_link=include.performed_in_link
         places=include.places
         places_link=include.places_link
         produced_by=include.produced_by
         produced_by_link=include.produced_by_link
         client=include.client
         client_link=include.client_link
         commissioned_by=include.commissioned_by
         commissioned_by_link=include.commissioned_by_link
         curated_by=include.curated_by
         curated_by_link=include.curated_by_link
         role=include.role
         role_link=include.role_link
         technology=include.technology
         technology_link=include.technology_link
         collaborators=include.collaborators
         collaborators_link=include.collaborators_link
         credits=include.credits
         credits_link=include.credits_link
         partners=include.partners
         partners_link=include.partners_link
         supporters=include.supporters
         supporters_link=include.supporters_link
         composer_performer_producer=include.composer_performer_producer
         composer_performer_producer_link=include.composer_performer_producer_link
         mastering_by=include.mastering_by
         mastering_by_link=include.mastering_by_link
         artwork_by=include.artwork_by
         artwork_by_link=include.artwork_by_link
         interview=include.interview
         interview_link=include.interview_link
         press_kit=include.press_kit
         press_kit_link=include.press_kit_link
         socials=include.socials
         socials_link=include.socials_link
         special_thanks=include.special_thanks
         special_thanks_link=include.special_thanks_link
         custom=include.custom
      %}

      {% comment %} Optional text content below metadata {% endcomment %}
      {% if include.text_content %}
        <div class="split-bandcamp-text">
          {% if include.text_title %}
            <h2>{{ include.text_title }}</h2>
          {% endif %}
          <div class="text-content">
            {{ include.text_content | markdownify }}
          </div>
        </div>
      {% endif %}
    </div>

  </div>
</div>
